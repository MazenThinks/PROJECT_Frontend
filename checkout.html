<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="styling.css" />
    <link rel="stylesheet" href="elecCat.css" />
    <title>Checkout</title>
  </head>
  <body>
    <header class="py-3 mb-0 border-bottom">
      <div
        class="container d-flex flex-row align-items-center justify-content-between gap-3 flex-wrap"
      >
        <a
          href="/"
          class="d-flex align-items-center mb-0 me-2 link-body-emphasis text-decoration-none titleanimation"
        >
          <img src="logoo/logo1.png" alt="logo" width="50px" height="40px" />
          <span class="fs-4 me-1 title">PickPay</span>
        </a>
        <form
          class="d-flex searchmarg position-relative flex-grow-1 mx-2"
          role="search"
          style="max-width: 600px"
        >
          <input
            class="form-control me-2 navsearch"
            type="search"
            placeholder="What are you looking for?"
            aria-label="Search"
            autocomplete="off"
          />
          <div
            id="searchDropdown"
            class="dropdown-menu w-100"
            style="
              max-height: 300px;
              overflow-y: auto;
              position: absolute;
              top: 100%;
              left: 0;
              z-index: 1000;
              display: none;
              background-color: var(--dropdown-bg, #fff);
              color: var(--input-text, #212529);
            "
          ></div>
        </form>
        <div class="cart text-decoration-none me-2">
          <a
            href="cart.html"
            class="d-flex align-items-center link-body-emphasis text-decoration-none cartanim"
          >
            <img
              src="Assets/cart.svg"
              width="23"
              height="23"
              fill="currentColor"
              class="bi bi-box-seam me-1"
              viewBox="0 0 16 16"
            />
            <span class="cartext">Cart</span>
          </a>
        </div>
        <div class="dark-mode-toggle d-flex align-items-center mx-2">
          <button
            id="darkModeToggle"
            class="btn btn-sm theme-toggle-btn"
            aria-label="Toggle dark mode"
          >
            <i class="fa-solid fa-moon"></i>
          </button>
        </div>
        <div class="text-end d-flex align-items-center ms-2">
          <a href="signinPage.html"
            ><button type="button" class="btn btn-light text-dark me-2 ms-2">
              Login
            </button></a
          >
          <a href="signupPage.html"
            ><button type="button" class="btn btn-primary">Sign Up</button></a
          >
        </div>
      </div>
    </header>
    <nav
      class="navbar navbar-expand-lg bg-body-tertiary second-navbar d-flex justify-content-center"
      style="
        background: none !important;
        background-color: var(--navbar-bg) !important;
      "
    >
      <div class="container-fluid d-flex flex-wrap justify-content-center">
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="collapse navbar-collapse d-flex justify-content-center"
          id="navbarNav"
        >
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="index.html">All</a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="elecCat.html">Electronics</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="ApplianCat.html">Appliances</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="HomeCat.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="videogamecat.html">Video Games</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="Fashion.html">Fashion</a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="Beauty.html">Beauty & Fragrance</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container mt-5">
      <main>
        <div class="py-5 text-center">
          <h2>Checkout</h2>
          <!-- <p class="lead">fill the following application</p> -->
        </div>

        <div class="row g-5">
          <div class="col-md-5 col-lg-4 order-md-last">
            <h4 class="d-flex justify-content-between align-items-center mb-3">
              <span class="text-primary">Your cart</span>
              <span class="badge bg-primary rounded-pill">3</span>
            </h4>
            <ul class="list-group mb-3">
              <li class="list-group-item d-flex justify-content-between lh-sm">
                <div>
                  <h6 class="my-0">Product name</h6>
                  <small class="text-body-secondary">Product 1</small>
                </div>
                <span class="text-body-secondary"> EGP 12</span>
              </li>
              <li class="list-group-item d-flex justify-content-between lh-sm">
                <div>
                  <h6 class="my-0">Second product</h6>
                  <small class="text-body-secondary">Product 2</small>
                </div>
                <span class="text-body-secondary"> EGP 8</span>
              </li>
              <li class="list-group-item d-flex justify-content-between lh-sm">
                <div>
                  <h6 class="my-0">Third item</h6>
                  <small class="text-body-secondary">Product 3</small>
                </div>
                <span class="text-body-secondary"> EGP 5</span>
              </li>
              <li
                class="list-group-item d-flex justify-content-between bg-body-tertiary"
              >
                <div class="text-success">
                  <h6 class="my-0">Promo code</h6>
                  <small>SAVE50</small>
                </div>
                <span class="text-success">− EGP 5</span>
              </li>
              <li class="list-group-item d-flex justify-content-between">
                <span>Total (EGP)</span>
                <strong> EGP 20</strong>
              </li>
            </ul>

            <form class="card p-2">
              <div class="input-group">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Promo code"
                />
                <button type="submit" class="btn btn-secondary">Redeem</button>
              </div>
            </form>
          </div>
          <div class="col-md-7 col-lg-8">
            <h4 class="mb-3">Billing address</h4>
            <form class="needs-validation" novalidate="">
              <div class="row g-3">
                <div class="col-sm-6">
                  <label for="firstName" class="form-label">First name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="firstName"
                    placeholder=""
                    value=""
                    required=""
                  />
                  <div class="invalid-feedback">
                    Valid first name is required.
                  </div>
                </div>

                <div class="col-sm-6">
                  <label for="lastName" class="form-label">Last name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="lastName"
                    placeholder=""
                    value=""
                    required=""
                  />
                  <div class="invalid-feedback">
                    Valid last name is required.
                  </div>
                </div>

                <div class="col-12">
                  <label for="username" class="form-label">Username</label>
                  <div class="input-group has-validation">
                    <span class="input-group-text">@</span>
                    <input
                      type="text"
                      class="form-control"
                      id="username"
                      placeholder="Username"
                      required=""
                    />
                    <div class="invalid-feedback">
                      Your username is required.
                    </div>
                  </div>
                </div>

                <div class="col-12">
                  <label for="email" class="form-label"
                    >Email
                    <span class="text-body-secondary">(Optional)</span></label
                  >
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    placeholder="you@example.com"
                  />
                  <div class="invalid-feedback">
                    Please enter a valid email address for shipping updates.
                  </div>
                </div>

                <div class="col-12">
                  <label for="address" class="form-label">Address</label>
                  <input
                    type="text"
                    class="form-control"
                    id="address"
                    placeholder="1234 Main St"
                    required=""
                  />
                  <div class="invalid-feedback">
                    Please enter your shipping address.
                  </div>
                </div>

                <div class="col-12">
                  <label for="address2" class="form-label"
                    >Address 2
                    <span class="text-body-secondary">(Optional)</span></label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="address2"
                    placeholder="Apartment or suite"
                  />
                </div>

                <div class="col-md-5">
                  <label for="country" class="form-label">Country</label>
                  <select class="form-select" id="country" required="">
                    <option value="">Choose...</option>
                    <option>Egypt</option>
                  </select>
                  <div class="invalid-feedback">
                    Please select a valid country.
                  </div>
                </div>

                <div class="col-md-4">
                  <label for="state" class="form-label">State</label>
                  <select class="form-select" id="state" required="">
                    <option value="">Choose...</option>
                    <option>Cairo</option>
                    <option>Giza</option>
                    <option>Alexandria</option>
                    <option>Menofia</option>
                    <option>Qalyubia</option>
                    <option>Sharm El Sheikh</option>
                    <option>Marsa Matrooh</option>
                    <option>Aswan</option>
                  </select>
                  <div class="invalid-feedback">
                    Please provide a valid state.
                  </div>
                </div>

                <div class="col-md-3">
                  <label for="zip" class="form-label">Phone Number</label>
                  <input
                    type="text"
                    class="form-control"
                    id="zip"
                    placeholder=""
                    required=""
                  />
                  <div class="invalid-feedback">Phone number required.</div>
                </div>
              </div>

              <hr class="my-4" />

              <div class="form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="same-address"
                />
                <label class="form-check-label" for="same-address"
                  >Shipping address is the same as my billing address</label
                >
              </div>

              <div class="form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="save-info"
                />
                <label class="form-check-label" for="save-info"
                  >Save this information for next time</label
                >
              </div>

              <hr class="my-4" />

              <h4 class="mb-3">Payment</h4>

              <div class="my-3">
                <div class="form-check">
                  <input
                    id="credit"
                    name="paymentMethod"
                    type="radio"
                    class="form-check-input"
                    checked=""
                    required=""
                  />
                  <label class="form-check-label" for="credit"
                    >Credit card</label
                  >
                </div>
                <div class="form-check">
                  <input
                    id="debit"
                    name="paymentMethod"
                    type="radio"
                    class="form-check-input"
                    required=""
                  />
                  <label class="form-check-label" for="debit">Debit card</label>
                </div>
                <div class="form-check">
                  <input
                    id="paypal"
                    name="paymentMethod"
                    type="radio"
                    class="form-check-input"
                    required=""
                  />
                  <label class="form-check-label" for="paypal">PayPal</label>
                </div>
                <div class="form-check">
                  <input
                    id="cash"
                    name="paymentMethod"
                    type="radio"
                    class="form-check-input"
                    required=""
                  />
                  <label class="form-check-label" for="paypal"
                    >Cash on delivery</label
                  >
                </div>
              </div>

              <div class="row gy-3" id="card-fields-row">
                <div class="col-md-6">
                  <label for="cc-name" class="form-label">Name on card</label>
                  <input
                    type="text"
                    class="form-control"
                    id="cc-name"
                    placeholder=""
                    required=""
                  />
                  <small class="text-body-secondary"
                    >Full name as displayed on card</small
                  >
                  <div class="invalid-feedback">Name on card is required</div>
                </div>

                <div class="col-md-6">
                  <label for="cc-number" class="form-label"
                    >Credit card number</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="cc-number"
                    placeholder=""
                    required=""
                  />
                  <div class="invalid-feedback">
                    Credit card number is required
                  </div>
                </div>

                <div class="col-md-3">
                  <label for="cc-expiration" class="form-label"
                    >Expiration</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="cc-expiration"
                    placeholder=""
                    required=""
                  />
                  <div class="invalid-feedback">Expiration date required</div>
                </div>

                <div class="col-md-3">
                  <label for="cc-cvv" class="form-label">CVV</label>
                  <input
                    type="text"
                    class="form-control"
                    id="cc-cvv"
                    placeholder=""
                    required=""
                  />
                  <div class="invalid-feedback">Security code required</div>
                </div>
              </div>
              <div class="row gy-3" id="paypal-field" style="display: none">
                <div class="col-12">
                  <label for="paypal-email" class="form-label"
                    >PayPal Email address</label
                  >
                  <input
                    type="email"
                    class="form-control"
                    id="paypal-email"
                    placeholder="you@example.com"
                    required
                  />
                  <div class="invalid-feedback">
                    Valid PayPal email is required
                  </div>
                </div>
              </div>

              <hr class="my-4" />
              <button
                class="w-100 btn btn-primary btn-lg mb-5"
                type="submit"
                id="place-order-btn"
              >
                Checkout
              </button>
            </form>
          </div>
        </div>
      </main>
    </div>

    <div class="text-center bg-body-tertiary">
      <footer class="py-4">
        <div class="row">
          <div class="col-6 col-md-2 mb-3">
            <h5>Electronics</h5>
            <ul class="nav flex-column">
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary"
                  >Mobile & Tablets</a
                >
              </li>
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary">TVs</a>
              </li>
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary">Laptop</a>
              </li>
            </ul>
          </div>

          <div class="col-6 col-md-2 mb-3">
            <h5>Appliances</h5>
            <ul class="nav flex-column">
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary"
                  >Large Appliances</a
                >
              </li>
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary"
                  >Small Appliances</a
                >
              </li>
            </ul>
          </div>

          <div class="col-6 col-md-2 mb-3">
            <h5>Home</h5>
            <ul class="nav flex-column">
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary"
                  >Furniture</a
                >
              </li>
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary"
                  >Home Decor</a
                >
              </li>
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary"
                  >Kitchen & Dining</a
                >
              </li>
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary"
                  >Bath & Bedding</a
                >
              </li>
            </ul>
          </div>

          <div class="col-6 col-md-2 mb-3">
            <h5>Video Games</h5>
            <ul class="nav flex-column">
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary">Console</a>
              </li>

              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary"
                  >Controllers</a
                >
              </li>
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary"
                  >Accessories</a
                >
              </li>
            </ul>
          </div>

          <div class="col-6 col-md-2 mb-3">
            <h5>Fashion</h5>
            <ul class="nav flex-column">
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary"
                  >Women's Fashion</a
                >
              </li>
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary"
                  >Men's Fashion</a
                >
              </li>
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary"
                  >Kids' Fashion</a
                >
              </li>
            </ul>
          </div>

          <div class="col-6 col-md-2 mb-3">
            <h5>Beauty & Fragrance</h5>
            <ul class="nav flex-column">
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary">Makeup</a>
              </li>
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary"
                  >Skincare</a
                >
              </li>
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary"
                  >Haircare</a
                >
              </li>
              <li class="nav-item mb-2">
                <a href="#" class="nav-link p-0 text-body-secondary"
                  >Fragrance</a
                >
              </li>
            </ul>
          </div>
        </div>

        <div class="py-5 border-top">
          <p>© 2025 PickPay, Inc. All rights reserved.</p>
        </div>
      </footer>
    </div>

    <script
      src="/docs/5.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script src="cart.js"></script>
    <script src="checkout.js"></script>
    <script src="script.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        // Stripe publishable key
        const stripe = Stripe(
          "pk_test_51RRcTiDEyCHwA6a7WqC7ypXHyDk87xUoNpbs68TdhjjLffPN2fSaoKquzQY5desPmDodUWrxgprTlXYXy1H41bKw00BM6RT6wB"
        );
        // Find the Place Order button (id="place-order-btn")
        const placeOrderBtn = document.getElementById("place-order-btn");
        if (placeOrderBtn) {
          placeOrderBtn.addEventListener("click", async function (e) {
            e.preventDefault();
            // Only allow card payments
            const credit = document.getElementById("credit");
            const debit = document.getElementById("debit");
            if (!(credit.checked || debit.checked)) {
              alert("Please select Credit or Debit card to pay online.");
              return;
            }
            // Get token and cartId
            const token = localStorage.getItem("token");
            if (!token) {
              alert("You must be logged in to place an order.");
              window.location.href = "signinPage.html";
              return;
            }
            // Get cartId from backend
            let cartId = null;
            if (document.getCart) {
              const cartData = await document.getCart();
              if (cartData && cartData.data && cartData.data._id) {
                cartId = cartData.data._id;
              }
            }
            if (!cartId) {
              alert("No cart found for this user.");
              return;
            }
            // Call backend to create Stripe session
            try {
              const res = await fetch(
                `http://localhost:3000/api/v1/orders/checkout-session/${cartId}?success_url=${encodeURIComponent(
                  window.location.origin + "/order-confirmation.html"
                )}&cancel_url=${encodeURIComponent(
                  window.location.origin + "/cart.html"
                )}`,
                {
                  method: "GET",
                  headers: {
                    Authorization: `Bearer ${token}`,
                  },
                }
              );
              const data = await res.json();
              if (
                res.ok &&
                data.status === "success" &&
                data.session &&
                data.session.id
              ) {
                // Redirect to Stripe Checkout
                stripe.redirectToCheckout({ sessionId: data.session.id });
              } else {
                alert(
                  "Failed to start Stripe Checkout: " +
                    (data.message || "Unknown error")
                );
              }
            } catch (err) {
              alert("Error connecting to payment: " + err.message);
            }
          });
        }
      });
    </script>
  </body>
</html>
